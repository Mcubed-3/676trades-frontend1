<script src="app.js"></script>
<script>
  async function refreshBilling(){
    const msg = document.getElementById("msg");
    msg.textContent = "Loading...";
    try{
      const s = await api("/billing/status","GET");
      document.getElementById("plan").textContent = s.plan || "free";
      document.getElementById("status").textContent = s.subscription_status || "none";
      document.getElementById("trial").textContent = s.trial_ends_at ? s.trial_ends_at : "-";
      msg.textContent = "";
    }catch(e){
      msg.textContent = "Error: " + e.message;
    }
  }

  document.getElementById("startBtn").onclick = async () => {
    const msg = document.getElementById("msg");
    msg.textContent = "Starting checkout...";
    try{
      const r = await api("/billing/create-checkout-session","POST",{});
      window.location.href = r.url; // Stripe hosted checkout
    }catch(e){
      msg.textContent = "Error: " + e.message;
    }
  };

  document.getElementById("manageBtn").onclick = async () => {
    const msg = document.getElementById("msg");
    msg.textContent = "Opening billing portal...";
    try{
      const r = await api("/billing/create-portal-session","POST",{});
      window.location.href = r.url;
    }catch(e){
      msg.textContent = "Error: " + e.message;
    }
  };

  document.getElementById("refreshBtn").onclick = refreshBilling;

  refreshBilling();
</script>
