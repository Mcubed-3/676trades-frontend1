<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>676Trades - Billing</title>
  <link rel="stylesheet" href="styles.css"/>
  <style>
    .banner{
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,180,0,0.08);
      border-radius:14px;
      padding:14px;
      margin-bottom:16px;
    }
    .banner h3{
      margin:0 0 6px 0;
      font-size:16px;
    }
    .banner .muted{
      opacity:0.85;
      font-size:13px;
      line-height:1.4;
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- COMPLIANCE / RISK BANNER -->
    <div class="banner">
      <h3>Important notice</h3>
      <div class="muted">
        Payments on 676Trades provide access to automated trading software only.
        We do not offer financial advice, investment guarantees, or managed accounts.
        Trading involves risk and you may lose part or all of your capital.
      </div>
    </div>

    <div class="nav">
      <div><b>676Trades</b></div>
      <div style="display:flex;gap:12px;align-items:center;">
        <a href="/dashboard.html">Dashboard</a>
        <a href="/account2.html">Account</a>
        <a href="#" onclick="logout()">Logout</a>
      </div>
    </div>

    <div class="card">
      <h1>Billing</h1>
      <div class="small">Manage your subscription and free trial.</div>
      <hr/>

      <div class="kv">
        <div><b>Plan</b><span id="plan">-</span></div>
        <div><b>Status</b><span id="status">-</span></div>
        <div><b>Trial ends</b><span id="trial">-</span></div>
      </div>

      <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;">
        <button id="startBtn">Start free trial / Subscribe</button>
        <button id="manageBtn" class="secondary">Manage billing</button>
        <button id="refreshBtn" class="secondary">Refresh</button>
      </div>

      <div id="msg" class="toast"></div>
    </div>

    <!-- FOOTER -->
    <footer class="footer">
      <div class="footer-inner">
        <span>© <span id="yr"></span> 676Trades</span>
        <span class="dot">·</span>
        <a href="/terms.html">Terms</a>
        <span class="dot">·</span>
        <a href="/privacy.html">Privacy</a>
        <span class="dot">·</span>
        <a href="/risk.html">Risk Disclosure</a>
        <span class="dot">·</span>
        <a href="mailto:support@676trades.org">Support</a>
      </div>
    </footer>
  </div>

  <script>
    (function(){
      var el = document.getElementById("yr");
      if(el) el.textContent = new Date().getFullYear();
    })();
  </script>

  <script src="app.js"></script>
  <script>
    async function refreshBilling(){
      const msg = document.getElementById("msg");
      msg.textContent = "Loading...";
      try{
        const s = await api("/billing/status","GET");
        document.getElementById("plan").textContent = s.plan || "free";
        document.getElementById("status").textContent = s.subscription_status || "none";
        document.getElementById("trial").textContent = s.trial_ends_at
          ? new Date(s.trial_ends_at).toLocaleString()
          : "-";
        msg.textContent = "";
      }catch(e){
        msg.textContent = "Error: " + e.message;
      }
    }

    document.getElementById("startBtn").onclick = async () => {
      const msg = document.getElementById("msg");
      msg.textContent = "Starting checkout...";
      try{
        const r = await api("/billing/create-checkout-session","POST",{});
        window.location.href = r.url;
      }catch(e){
        msg.textContent = "Error: " + e.message;
      }
    };

    document.getElementById("manageBtn").onclick = async () => {
      const msg = document.getElementById("msg");
      msg.textContent = "Opening billing portal...";
      try{
        const r = await api("/billing/create-portal-session","POST",{});
        window.location.href = r.url;
      }catch(e){
        msg.textContent = "Error: " + e.message;
      }
    };

    document.getElementById("refreshBtn").onclick = refreshBilling;

    refreshBilling();
  </script>
</body>
</html>
